<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings | Calamansi Yield System</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
        
        .nav-item {
            @apply px-4 py-3 text-left rounded-lg transition font-medium;
        }
        
        .nav-item.active {
            @apply bg-lime-100 text-lime-700;
        }
        
        .nav-item.inactive {
            @apply text-slate-600 hover:bg-slate-50;
        }
        
        .tab-content {
            @apply hidden;
        }
        
        .tab-content.active {
            @apply block;
        }
        
        .password-strength-weak { @apply bg-red-500; }
        .password-strength-medium { @apply bg-yellow-500; }
        .password-strength-strong { @apply bg-green-500; }
    </style>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        lime: {
                            50: '#f7fee7', 100: '#ecfccb', 500: '#84cc16',
                            600: '#65a30d', 700: '#4d7c0f', 900: '#365314',
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-slate-50 text-slate-800">
    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar Backdrop -->
        <div id="sidebar-backdrop" class="fixed inset-0 bg-black/50 z-20 hidden md:hidden"></div>
        
         <!---Side bar-->
           <aside id="sidebar" class="w-64 bg-lime-900 text-white fixed inset-y-0 left-0 transform -translate-x-full md:translate-x-0 md:static flex flex-col z-30 flex-shrink-0 transition-all duration-300">
            <div class="p-6 flex items-center justify-between border-b border-lime-800">
                <div class="flex items-center gap-3">
                    <img src="../images/cys_logo.png" alt="CYS Logo" class="w-20 h-20 object-contain"/>
                    <span class="font-bold text-lg tracking-wide">Calamansi Yield System</span>
                </div>
                <button id="sidebar-close" class="md:hidden text-lime-200 hover:text-white">
                    <i class="fa-solid fa-xmark text-xl"></i>
                </button>
            </div>
            <nav class="flex-1 p-4 space-y-2 overflow-y-auto">
                <a href="farmer_dashboard.html" class="flex items-center gap-3 px-4 py-3 text-lime-200 hover:bg-lime-800 hover:text-white rounded-xl transition">
                    <i class="fa-solid fa-gauge-high w-5"></i> Dashboard
                </a>
                <a href="farmer_request.html" class="flex items-center gap-3 px-4 py-3 text-lime-200 hover:bg-lime-800 hover:text-white rounded-xl transition">
                    <i class="fa-solid fa-clipboard-check w-5"></i> Add Yield Record
                </a>
                <a href="farmer_yield_history.html" class="flex items-center gap-3 px-4 py-3 text-lime-200 hover:bg-lime-800 hover:text-white rounded-xl transition">
                    <i class="fa-solid fa-clock-rotate-left w-5"></i> Yield History
                </a>
                <a href="farmer_settings.html" class="flex items-center gap-3 px-4 py-3 bg-lime-800 rounded-xl text-white font-medium shadow-inner">
                    <i class="fa-solid fa-gear w-5"></i> Settings
                </a>
            </nav>
            
            <div class="p-4 border-t border-lime-800">
                <div class="flex items-center gap-3 p-3 rounded-lg bg-lime-800/50">
                    <img id="sidebar-avatar" src="https://api.dicebear.com/7.x/avataaars/svg?seed=Farmer" class="w-8 h-8 rounded-full bg-white" alt="Farmer">
                    
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-medium text-white truncate" id="user-display-name">Farmer</p>
                        <p class="text-xs text-lime-300 truncate" id="user-display-email">Loading...</p>
                    </div>
                    
                    <button id="btn-logout-trigger" class="text-lime-300 hover:text-white transition-colors p-2 rounded-md hover:bg-lime-700/50" title="Sign Out">
                        <i class="fa-solid fa-right-from-bracket"></i>
                    </button>
                </div>
            </div>
        </aside>

        <main class="flex-1 flex flex-col h-full overflow-hidden relative">
            
            <header class="h-16 bg-white border-b border-slate-200 flex items-center justify-between px-6 z-10 flex-shrink-0">
                <div class="flex items-center gap-2 md:hidden">
                    <button id="sidebar-toggle" class="text-slate-600"><i class="fa-solid fa-bars text-xl"></i></button>
                    <span class="font-bold text-lime-900">Settings</span>
                </div>
                <div class="hidden md:block">
                    <h1 class="text-xl font-bold text-slate-800">Account Settings</h1>
                </div>
                <div class="flex items-center gap-4">
                    <div class="text-right hidden sm:block">
                        <p class="text-sm font-bold text-slate-700">My Account</p>
                        <p class="text-xs text-slate-500">Manage your profile</p>
                    </div>
                    <div class="w-10 h-10 bg-lime-100 rounded-full flex items-center justify-center text-lime-700">
                        <i class="fa-solid fa-bell"></i>
                    </div>
                </div>
            </header>

            <div class="flex-1 overflow-y-auto p-4 md:p-8">
                <div class="max-w-6xl mx-auto">
                    <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                        <!-- Sidebar Navigation -->
                        <div class="lg:col-span-1">
                            <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-2">
                                <nav class="space-y-1">
                                    <button class="nav-item active w-full flex items-center gap-3 px-4 py-3 text-left rounded-lg transition font-medium" data-tab="profile">
                                        <i class="fa-solid fa-user text-lime-600"></i>
                                        <span>Profile</span>
                                    </button>
                                    <button class="nav-item inactive w-full flex items-center gap-3 px-4 py-3 text-left rounded-lg transition text-slate-600 hover:bg-slate-50" data-tab="security">
                                        <i class="fa-solid fa-lock text-slate-400"></i>
                                        <span>Security</span>
                                    </button>
                                    <button class="nav-item inactive w-full flex items-center gap-3 px-4 py-3 text-left rounded-lg transition text-slate-600 hover:bg-slate-50" data-tab="account">
                                        <i class="fa-solid fa-id-card text-slate-400"></i>
                                        <span>Account Info</span>
                                    </button>
                                </nav>
                            </div>
                        </div>

                        <!-- Main Content -->
                        <div class="lg:col-span-3">
                            <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                                <!-- Profile Tab -->
                                <div id="profile-tab" class="tab-content active p-6">
                                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                                        <div class="lg:col-span-1">
                                            <h3 class="text-lg font-semibold text-slate-800 mb-4">Profile Picture</h3>
                                            <div class="flex flex-col items-center space-y-4">
                                                <div class="relative">
                                                    <img id="profile-image" src="https://api.dicebear.com/7.x/avataaars/svg?seed=Farmer" alt="Profile" class="w-24 h-24 rounded-full border-4 border-lime-200">
                                                    <div class="absolute bottom-0 right-0 bg-white rounded-full p-2 shadow-md border border-slate-200">
                                                        <i class="fa-solid fa-camera text-slate-600"></i>
                                                    </div>
                                                </div>
                                                <div class="space-y-2 w-full">
                                                    <button id="upload-photo" class="w-full bg-lime-600 hover:bg-lime-700 text-white py-2 px-4 rounded-lg text-sm font-medium transition flex items-center justify-center gap-2">
                                                        <i class="fa-solid fa-upload"></i> Upload New
                                                    </button>
                                                    <button id="remove-photo" class="w-full bg-slate-100 hover:bg-slate-200 text-slate-700 py-2 px-4 rounded-lg text-sm font-medium transition flex items-center justify-center gap-2">
                                                        <i class="fa-solid fa-trash"></i> Remove
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="lg:col-span-2">
                                            <h3 class="text-lg font-semibold text-slate-800 mb-6">Personal Information</h3>
                                            <form id="profile-form" class="space-y-6">
                                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                                                    <div>
                                                        <label class="block text-sm font-medium text-slate-700 mb-2">First Name</label>
                                                        <input type="text" id="first-name" required class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-lime-500 focus:border-lime-500 transition">
                                                    </div>
                                                    <div>
                                                        <label class="block text-sm font-medium text-slate-700 mb-2">Last Name</label>
                                                        <input type="text" id="last-name" required class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-lime-500 focus:border-lime-500 transition">
                                                    </div>
                                                </div>
                                                
                                                <div>
                                                    <label class="block text-sm font-medium text-slate-700 mb-2">Email Address</label>
                                                    <input type="email" id="email" required class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-lime-500 focus:border-lime-500 bg-slate-50 transition" readonly>
                                                </div>
                                                
                                                <div>
                                                    <label class="block text-sm font-medium text-slate-700 mb-2">Phone Number</label>
                                                    <input type="tel" id="phone" class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-lime-500 focus:border-lime-500 transition">
                                                </div>
                                                
                                                <div>
                                                    <label class="block text-sm font-medium text-slate-700 mb-2">Address</label>
                                                    <textarea id="address" rows="4" class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-lime-500 focus:border-lime-500 transition"></textarea>
                                                </div>
                                                
                                                <div class="pt-4">
                                                    <button type="submit" class="bg-lime-600 hover:bg-lime-700 text-white py-3 px-8 rounded-lg font-medium transition flex items-center gap-2">
                                                        <i class="fa-solid fa-save"></i> Save Changes
                                                    </button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>

                                <!-- Security Tab -->
                                <div id="security-tab" class="tab-content p-6">
                                    <h3 class="text-lg font-semibold text-slate-800 mb-6">Password Security</h3>
                                    <form id="security-form" class="max-w-2xl space-y-6">
                                        <div>
                                            <label class="block text-sm font-medium text-slate-700 mb-2">Current Password</label>
                                            <input type="password" id="current-password" required class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-lime-500 focus:border-lime-500 transition">
                                        </div>
                                        
                                        <div>
                                            <label class="block text-sm font-medium text-slate-700 mb-2">New Password</label>
                                            <input type="password" id="new-password" required class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-lime-500 focus:border-lime-500 transition">
                                            <div class="mt-3">
                                                <div class="w-full bg-slate-200 rounded-full h-2">
                                                    <div id="password-strength-bar" class="h-2 rounded-full transition-all"></div>
                                                </div>
                                                <p id="password-strength-text" class="text-xs text-slate-500 mt-2">Password strength</p>
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <label class="block text-sm font-medium text-slate-700 mb-2">Confirm New Password</label>
                                            <input type="password" id="confirm-password" required class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-lime-500 focus:border-lime-500 transition">
                                        </div>
                                        
                                        <div class="pt-6">
                                            <button type="submit" class="bg-lime-600 hover:bg-lime-700 text-white py-3 px-8 rounded-lg font-medium transition flex items-center gap-2">
                                                <i class="fa-solid fa-key"></i> Update Password
                                            </button>
                                        </div>
                                    </form>
                                </div>

                                <!-- Account Info Tab -->
                                <div id="account-tab" class="tab-content p-6">
                                    <h3 class="text-lg font-semibold text-slate-800 mb-6">Account Information</h3>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div class="space-y-6">
                                            <div class="bg-slate-50 p-4 rounded-lg border border-slate-200">
                                                <h4 class="font-medium text-slate-800 mb-3 flex items-center gap-2">
                                                    <i class="fa-solid fa-id-badge text-lime-600"></i> Identity Information
                                                </h4>
                                                <div class="space-y-4">
                                                    <div>
                                                        <label class="block text-sm font-medium text-slate-600 mb-1">User ID</label>
                                                        <input type="text" id="user-id-display" readonly class="w-full px-3 py-2 bg-white border border-slate-200 rounded-lg text-slate-700 cursor-not-allowed">
                                                    </div>
                                                    <div>
                                                        <label class="block text-sm font-medium text-slate-600 mb-1">Email</label>
                                                        <input type="text" id="account-email-display" readonly class="w-full px-3 py-2 bg-white border border-slate-200 rounded-lg text-slate-700 cursor-not-allowed">
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="bg-slate-50 p-4 rounded-lg border border-slate-200">
                                                <h4 class="font-medium text-slate-800 mb-3 flex items-center gap-2">
                                                    <i class="fa-solid fa-shield-alt text-blue-600"></i> Verification Status
                                                </h4>
                                                <div class="space-y-4">
                                                    <div>
                                                        <label class="block text-sm font-medium text-slate-600 mb-1">Email Verified</label>
                                                        <div class="flex items-center gap-3">
                                                            <input type="text" id="email-verified-display" readonly class="flex-1 px-3 py-2 bg-white border border-slate-200 rounded-lg text-slate-700 cursor-not-allowed">
                                                            <span id="email-verified-icon" class="text-slate-400">
                                                                <i class="fa-solid fa-circle-question"></i>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="space-y-6">
                                            <div class="bg-slate-50 p-4 rounded-lg border border-slate-200">
                                                <h4 class="font-medium text-slate-800 mb-3 flex items-center gap-2">
                                                    <i class="fa-solid fa-history text-green-600"></i> Account Activity
                                                </h4>
                                                <div class="space-y-4">
                                                    <div>
                                                        <label class="block text-sm font-medium text-slate-600 mb-1">Account Created</label>
                                                        <input type="text" id="account-created-display" readonly class="w-full px-3 py-2 bg-white border border-slate-200 rounded-lg text-slate-700 cursor-not-allowed">
                                                    </div>
                                                    <div>
                                                        <label class="block text-sm font-medium text-slate-600 mb-1">Last Login</label>
                                                        <input type="text" id="last-login-display" readonly class="w-full px-3 py-2 bg-white border border-slate-200 rounded-lg text-slate-700 cursor-not-allowed">
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="bg-slate-50 p-4 rounded-lg border border-slate-200">
                                                <h4 class="font-medium text-slate-800 mb-3 flex items-center gap-2">
                                                    <i class="fa-solid fa-server text-purple-600"></i> Authentication
                                                </h4>
                                                <div class="space-y-4">
                                                    <div>
                                                        <label class="block text-sm font-medium text-slate-600 mb-1">Provider</label>
                                                        <input type="text" id="auth-provider-display" readonly class="w-full px-3 py-2 bg-white border border-slate-200 rounded-lg text-slate-700 cursor-not-allowed">
                                                    </div>
                                                    <div>
                                                        <label class="block text-sm font-medium text-slate-600 mb-1">Status</label>
                                                        <div class="flex items-center gap-3">
                                                            <input type="text" id="account-status-display" readonly class="flex-1 px-3 py-2 bg-white border border-slate-200 rounded-lg text-slate-700 cursor-not-allowed">
                                                            <span id="account-status-icon" class="text-green-500">
                                                                <i class="fa-solid fa-circle-check"></i>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-8 p-4 bg-blue-50 rounded-lg border border-blue-200">
                                        <div class="flex items-start gap-3">
                                            <i class="fa-solid fa-info-circle text-blue-600 mt-1"></i>
                                            <div>
                                                <h4 class="font-medium text-blue-800 mb-1">Security Tips</h4>
                                                <ul class="text-sm text-blue-700 space-y-1">
                                                    <li>• Keep your User ID secure and private</li>
                                                    <li>• Verify your email to unlock full account features</li>
                                                    <li>• Update your password regularly for enhanced security</li>
                                                    <li>• Monitor your last login time for suspicious activity</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Remove Photo Modal -->
    <div id="remove-photo-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center">
        <div class="modal-backdrop absolute inset-0 bg-black/40"></div>
            <div class="bg-white p-6 rounded-xl relative w-full max-w-sm mx-4 shadow-xl">
                <div class="text-center mb-6">
                    <div class="w-12 h-12 bg-red-100 text-red-600 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fa-solid fa-trash-can text-xl"></i>
                    </div>
                    <h3 class="text-lg font-bold text-slate-800">Remove Photo?</h3>
                    <p class="text-sm text-slate-500 mt-2">This will delete your current profile picture and revert to the default avatar.</p>
                </div>
                <div class="flex gap-3">
                    <button id="btn-cancel-remove" class="flex-1 px-4 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-lg font-medium transition">
                        Cancel
                    </button>
                    <button id="btn-confirm-remove" class="flex-1 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition">
                        Remove
                    </button>
                </div>
            </div>
    </div>

    <script type="module">
        import { app } from '../firebase-config.js';
        import { initAuthSidebar } from '../js/Auth.js';
        import { 
            getAuth, 
            onAuthStateChanged,
            signOut,
            updateProfile,
            updateEmail,
            sendEmailVerification
        } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";
        import { 
            getFirestore, 
            doc, 
            getDoc,
            updateDoc
        } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

        const auth = getAuth(app);
        const db = getFirestore(app);

        // Initialize responsive sidebar and profile sync
        initAuthSidebar();

        // DOM Elements
        const userDisplayName = document.getElementById('user-display-name');
        const userDisplayEmail = document.getElementById('user-display-email');
        const profileImage = document.getElementById('profile-image');
        const tabButtons = document.querySelectorAll('[data-tab]');
        const tabContents = document.querySelectorAll('.tab-content');
        const profileForm = document.getElementById('profile-form');
        const securityForm = document.getElementById('security-form');
        
        // Tab functionality
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const tabId = button.getAttribute('data-tab');
                
                // Update button states
                tabButtons.forEach(btn => {
                    if (btn === button) {
                        btn.className = 'nav-item active w-full flex items-center gap-3 px-4 py-3 text-left rounded-lg transition font-medium';
                    } else {
                        btn.className = 'nav-item inactive w-full flex items-center gap-3 px-4 py-3 text-left rounded-lg transition text-slate-600 hover:bg-slate-50';
                    }
                });
                
                // Show selected tab content
                tabContents.forEach(content => {
                    if (content.id === `${tabId}-tab`) {
                        content.classList.add('active');
                        content.classList.remove('hidden');
                    } else {
                        content.classList.remove('active');
                        content.classList.add('hidden');
                    }
                });
            });
        });

        // Check authentication
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                try {
                    const userDoc = await getDoc(doc(db, "users", user.uid));
                    if (userDoc.exists()) {
                        const userData = userDoc.data();
                        const fullName = `${userData.firstName} ${userData.surname || userData.lastName || ''}`;
                        userDisplayName.textContent = fullName;
                        userDisplayEmail.textContent = userData.email;
                        
                        // Update profile form
                        document.getElementById('first-name').value = userData.firstName || '';
                        document.getElementById('last-name').value = userData.surname || userData.lastName || '';
                        document.getElementById('email').value = userData.email || '';
                        document.getElementById('phone').value = userData.phoneNumber || '';
                        document.getElementById('address').value = userData.address || '';
                        
                        // Update profile image
                        if (userData.photoURL) {
                            profileImage.src = userData.photoURL;
                        } else {
                            profileImage.src = `https://api.dicebear.com/7.x/avataaars/svg?seed=${userData.surname || userData.firstName}`;
                        }
                        
                        // Update account info tab
                        document.getElementById('user-id-display').value = user.uid;
                        document.getElementById('account-email-display').value = userData.email || user.email;
                        document.getElementById('account-created-display').value = userData.createdAt?.toDate ? userData.createdAt.toDate().toLocaleDateString() : 'Unknown';
                        document.getElementById('auth-provider-display').value = user.providerData[0]?.providerId || 'Email/Password';
                        document.getElementById('last-login-display').value = user.metadata.lastSignInTime ? new Date(user.metadata.lastSignInTime).toLocaleString() : 'Unknown';
                        document.getElementById('account-status-display').value = user.emailVerified ? 'Verified' : 'Not Verified';
                        
                        // Update email verified status
                        document.getElementById('email-verified-display').value = user.emailVerified ? 'Verified' : 'Pending';
                        const emailVerifiedIcon = document.getElementById('email-verified-icon');
                        if (user.emailVerified) {
                            emailVerifiedIcon.innerHTML = '<i class="fa-solid fa-circle-check text-green-500"></i>';
                        } else {
                            emailVerifiedIcon.innerHTML = '<i class="fa-solid fa-circle-xmark text-red-500"></i>';
                        }
                        
                        // Set account status icon
                        const accountStatusIcon = document.getElementById('account-status-icon');
                        if (user.emailVerified) {
                            accountStatusIcon.className = 'text-green-500';
                            accountStatusIcon.innerHTML = '<i class="fa-solid fa-circle-check"></i>';
                        } else {
                            accountStatusIcon.className = 'text-red-500';
                            accountStatusIcon.innerHTML = '<i class="fa-solid fa-circle-xmark"></i>';
                        }
                        
                        // Check if user is admin (should not be here)
                        if (userData.role === 'admin') {
                            // For admin users, redirect to admin settings
                            // But since this is farmer_settings.html, we'll keep them here
                            // In a real app, you might want separate admin/farmer settings
                        }
                    }
                } catch (error) {
                    console.error("Error fetching user data:", error);
                }
            } else {
                window.location.href = '../index.html';
            }
        });

        // Profile form submission
        profileForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            try {
                const user = auth.currentUser;
                if (!user) return;
                
                const firstName = document.getElementById('first-name').value;
                const lastName = document.getElementById('last-name').value;
                const phone = document.getElementById('phone').value;
                const address = document.getElementById('address').value;
                
                // Update Firestore user document
                await updateDoc(doc(db, "users", user.uid), {
                    firstName: firstName,
                    surname: lastName,
                    phoneNumber: phone,
                    address: address
                });
                
                // Update Firebase Auth display name
                await updateProfile(user, {
                    displayName: `${firstName} ${lastName}`
                });
                
                alert('Profile updated successfully!');
            } catch (error) {
                console.error("Error updating profile:", error);
                alert('Error updating profile. Please try again.');
            }
        });

        // Security form submission (password update)
        securityForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            
            if (newPassword !== confirmPassword) {
                alert('New passwords do not match!');
                return;
            }
            
            if (newPassword.length < 6) {
                alert('Password must be at least 6 characters long!');
                return;
            }
            
            // Note: Actual password change requires re-authentication
            // This is a simplified version - in a real app you'd need to implement proper password change flow
            alert('Password update functionality requires re-authentication. This is a simplified demo.');
        });

        // Logout functionality
        document.getElementById('btn-logout-trigger').addEventListener('click', () => {
            signOut(auth).then(() => {
                window.location.href = '../index.html';
            });
        });

        // Remove photo functionality
        document.getElementById('remove-photo').addEventListener('click', () => {
            document.getElementById('remove-photo-modal').classList.remove('hidden');
        });

        document.getElementById('btn-cancel-remove').addEventListener('click', () => {
            document.getElementById('remove-photo-modal').classList.add('hidden');
        });

        document.getElementById('btn-confirm-remove').addEventListener('click', async () => {
            try {
                const user = auth.currentUser;
                if (!user) return;
                
                // Remove photo from Firestore
                await updateDoc(doc(db, "users", user.uid), {
                    photoURL: null
                });
                
                // Update profile image
                const userData = await getDoc(doc(db, "users", user.uid));
                const userDoc = userData.data();
                document.getElementById('profile-image').src = `https://api.dicebear.com/7.x/avataaars/svg?seed=${userDoc.surname || userDoc.firstName}`;
                
                document.getElementById('remove-photo-modal').classList.add('hidden');
                alert('Profile photo removed successfully!');
            } catch (error) {
                console.error("Error removing photo:", error);
                alert('Error removing photo. Please try again.');
            }
        });
    </script>
</body>
</html>